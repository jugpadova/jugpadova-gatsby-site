{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/articles/2007/03/13/tomcat-5-5-20-and-javamail-sessions/",
    "result": {"data":{"site":{"siteMetadata":{"title":"JUG Padova"}},"markdownRemark":{"id":"3c15d9c7-9d05-5f33-9e59-dac9056f8341","excerpt":"You’ll find an article in italian on the same topic in my personal blog. In Tomcat you can define a JNDI Resource for a JavaMail session putting the following…","html":"<p><em>You’ll find an article in italian on the same topic in <a href=\"http://benfante.blogspot.com/2007/03/tomcat-castrato.html\">my personal blog</a>.</em></p>\n<p>In <a href=\"http://tomcat.apache.org\">Tomcat</a> you can define a JNDI Resource for a JavaMail session putting the following code in you Context definition:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Resource</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mail/Session<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">auth</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Container<span class=\"token punctuation\">\"</span></span>\r\n            <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>javax.mail.Session<span class=\"token punctuation\">\"</span></span>\r\n            <span class=\"token attr-name\">mail.smtp.host</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>localhost<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>And in you web.xml:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resource-ref</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>res-ref-name</span><span class=\"token punctuation\">></span></span>mail/Session<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>res-ref-name</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>res-type</span><span class=\"token punctuation\">></span></span>javax.mail.Session<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>res-type</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>res-auth</span><span class=\"token punctuation\">></span></span>Container<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>res-auth</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resource-ref</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Then you can use it in you code:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Context</span> initCtx <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InitialContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token class-name\">Session</span> session <span class=\"token operator\">=</span>\r\n    <span class=\"token punctuation\">(</span><span class=\"token class-name\">Session</span><span class=\"token punctuation\">)</span> envCtx<span class=\"token punctuation\">.</span><span class=\"token function\">lookup</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"java:comp/env/mail/Session\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Using Tomcat 5.5.20 (and 5.5.17, and 5.5.23…and maybe other versions) the last statement will produce a <code>ClassNotFoundException: org.apache.naming.factory.MailSessionFactory</code>. The cause is obviously that class is missing from the <code>common/lib/naming-factory.jar</code> distributed by Tomcat. I don’t know if it was a (repeated) problem in building Tomcat. Luckly the source code of that class is still present in the source distribution of Tomcat. Simply it isn’t included in the build process if you don’t have the <a href=\"http://java.sun.com/products/javamail/\">JavaMail</a> and the <a href=\"http://java.sun.com/products/javabeans/jaf/\">JavaBeans Activation Framework</a> in the build classpath. So I re-built the <code>naming-factory.jar</code> file and substituted in <code>common/lib</code>.</p>\n<p>You can rebuild your own JAR, or download my new <a href=\"http://snipurl.com/nfjar\">naming-factory.jar</a>.</p>\n<p>I discovered this problem (bug?) installing <a href=\"http://www.liferay.com/\">LifeRay</a> 4.1.2 using the WAR distribution. On the contrary the LifeRay-Tomcat bundle contains the correct <code>naming-factory.jar</code> yet. The LifeRay error in this case is more obscure. It reports a <code>javax.naming.NameNotFoundException: Name mail is not bound in this Context</code>! Of course the JNDI Resource is correctly configured. This happens because LifeRay try to guess the JNDI name of the resource, that changes for the different application servers. So that exception comes from one of the attempts, and the real problem is lost and hidden. So, if you’ll see a such message, don’t spend time re-re-re-configuring your JNDI resources…but patch Tomcat!</p>","frontmatter":{"title":"Tomcat 5.5.20 and JavaMail Sessions","date":"13 marzo 2007","description":null,"author":{"username":"lucio.benfante","fullname":"Lucio Benfante","email":"lucio.benfante@jugpadova.it"},"categories":[{"name":"Tips & Tricks","permalink":"tips-and-tricks"},{"name":"Programmazione","permalink":"programmazione"}],"tags":[{"name":"tomcat","display":"Tomcat"},{"name":"javamail","display":"JavaMail"},{"name":"jndi","display":"JNDI"},{"name":"bug","display":"bug"}]}},"previous":{"fields":{"slug":"/articles/2007/02/26/lwjgl-1-0-released/"},"frontmatter":{"title":"LWJGL 1.0 released"}},"next":{"fields":{"slug":"/articles/2007/03/17/jug-meeting-33/"},"frontmatter":{"title":"JUG Meeting #33"}}},"pageContext":{"id":"3c15d9c7-9d05-5f33-9e59-dac9056f8341","previousPostId":"f3ac0a61-ec08-5195-bc53-e799e953afdc","nextPostId":"e874bc8d-3f81-50cb-ae69-55de1bbd8ef0"}},
    "staticQueryHashes": ["2841359383"]}